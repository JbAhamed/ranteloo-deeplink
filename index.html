<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Open Ranteloo App</title>
</head>
<body>
  <script>
    const params = new URLSearchParams(window.location.search);
    const id = params.get("id");
    
    const iosStore = "https://apps.apple.com/app/idXXXXXX";
    const androidStore = "https://play.google.com/store/apps/details?id=com.bidyava.solutions";
    
    const isIOS = /iPhone|iPad|iPod/i.test(navigator.userAgent);
    const isAndroid = /Android/i.test(navigator.userAgent);
    
    let fallbackTimeout;
    let didHideOrBlur = false;

    function clearFallback() {
      didHideOrBlur = true;
      clearTimeout(fallbackTimeout);
    }

    function openApp() {
      if (isAndroid) {
        // Use Android Intent URL - OS handles fallback natively
        const intentUrl = `intent://postdetails/${id}#Intent;scheme=ranteloo;package=com.bidyava.solutions;S.browser_fallback_url=${encodeURIComponent(androidStore)};end`;
        window.location.href = intentUrl;
      } else if (isIOS) {
        // iOS: Use custom scheme with JS fallback
        window.location.href = `ranteloo://postdetails/${id}`;
        
        fallbackTimeout = setTimeout(() => {
          if (!didHideOrBlur) {
            window.location.href = iosStore;
          }
        }, 2500);
      } else {
        // Desktop or unknown - just show store link or message
        window.location.href = androidStore;
      }
    }

    // Multiple events to catch app opening
    document.addEventListener("visibilitychange", () => {
      if (document.hidden) clearFallback();
    });
    
    window.addEventListener("pagehide", clearFallback);
    window.addEventListener("blur", clearFallback);

    openApp();
  </script>
</body>
</html>
