<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Open Ranteloo App</title>
</head>
<body>
<script>
  const params = new URLSearchParams(window.location.search);
  const id = params.get("id");

  const appLink = `ranteloo://postdetails/${id}`;
  const iosStore = "https://apps.apple.com/app/idXXXXXX";
  const androidStore = "https://play.google.com/store/apps/details?id=com.bidyava.solutions";

  let fallbackTriggered = false;
  let timeout;

  function goToStore() {
    if (fallbackTriggered) return;
    fallbackTriggered = true;

    const isIOS = /iPhone|iPad|iPod/i.test(navigator.userAgent);
    window.location.href = isIOS ? iosStore : androidStore;
  }

  function openApp() {
    const now = Date.now();

    window.location.href = appLink;

    // Start fallback timer
    timeout = setTimeout(() => {
      // If user is still on the page → app did NOT open
      if (Date.now() - now > 3500) {
        goToStore();
      }
    }, 3000);
  }

  // If app actually opens → page becomes hidden OR blurred → cancel fallback
  const cancelFallback = () => {
    clearTimeout(timeout);
    fallbackTriggered = true;
  };

  document.addEventListener("visibilitychange", cancelFallback);
  window.addEventListener("blur", cancelFallback);
  window.addEventListener("pagehide", cancelFallback);

  openApp();
</script>
</body>
</html>
